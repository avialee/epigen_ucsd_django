control_1<-read.table("/Users/liyuxin/projects/hopkins/data/C66_H3K36me3_x_LYX_7_1_2.peak_len",stringsAsFactors=F)
control_2<-read.table("/Users/liyuxin/projects/hopkins/data/C70_H3K36me3_x_LYX_1_1_2.peak_len",stringsAsFactors=F)
control_3<-read.table("/Users/liyuxin/projects/hopkins/data/C84_H3K36me3_x_LYX_14_1_2.peak_len",stringsAsFactors=F)
merged<-read.table("/Users/liyuxin/projects/hopkins/data/merged_normoxia.peak_len",stringsAsFactors=F)
patient_1<-data.matrix(patient_1)
patient_2<-data.matrix(patient_2)
control_1<-data.matrix(control_1)
control_2<-data.matrix(control_2)
control_3<-data.matrix(control_3)
merged<-data.matrix(merged)
patient_1_anno<-rep('patient_1',length(patient_1))
patient_2_anno<-rep('patient_2',length(patient_2))
control_1_anno<-rep('control_1',length(control_1))
control_2_anno<-rep('control_2',length(control_2))
control_3_anno<-rep('control_3',length(control_3))
merged_anno<-rep('merged',length(merged))
df <- data.frame(len=c(log10(patient_1),log10(patient_2),log10(control_1),log10(control_2),log10(control_3),log10(merged)),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno,merged_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 1)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
library(ggplot2)
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 1)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 99)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.99)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
df <- data.frame(len=c(patient_1,patient_2,control_1,control_2,control_3,merged),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno,merged_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.99)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
df <- data.frame(len=c(patient_1,patient_2,control_1,control_2,control_3,merged),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno,merged_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.9)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
patient_1<-read.table("/Users/liyuxin/projects/hopkins/data/Kpat_Hypoxia_H3K36me3_r1_x_LYX_11_1_2.peak_len",stringsAsFactors=F)
patient_2<-read.table("/Users/liyuxin/projects/hopkins/data/K36me3_pat_hyp_x_AVD_297_1_2.peak_len",stringsAsFactors=F)
control_1<-read.table("/Users/liyuxin/projects/hopkins/data/C66_Hypoxia_H3K36me3_r1_x_LYX_4_1_2.peak_len",stringsAsFactors=F)
control_2<-read.table("/Users/liyuxin/projects/hopkins/data/C70_Hypoxia_H3K36me3_r1_x_LYX_8_1_2.peak_len",stringsAsFactors=F)
control_3<-read.table("/Users/liyuxin/projects/hopkins/data/C84_Hypoxia_H3K36me3_r1_x_LYX_16_1_2.peak_len",stringsAsFactors=F)
merged<-read.table("/Users/liyuxin/projects/hopkins/data/merged_hypoxia.peak_len",stringsAsFactors=F)
patient_1<-data.matrix(patient_1)
patient_2<-data.matrix(patient_2)
control_1<-data.matrix(control_1)
control_2<-data.matrix(control_2)
control_3<-data.matrix(control_3)
merged<-data.matrix(merged)
patient_1_anno<-rep('patient_1',length(patient_1))
patient_2_anno<-rep('patient_2',length(patient_2))
control_1_anno<-rep('control_1',length(control_1))
control_2_anno<-rep('control_2',length(control_2))
control_3_anno<-rep('control_3',length(control_3))
merged_anno<-rep('merged',length(merged))
df <- data.frame(len=c(patient_1,patient_2,control_1,control_2,control_3,merged),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno,merged_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.9)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
df <- data.frame(len=c(log10(patient_1),log10(patient_2),log10(control_1),log10(control_2),log10(control_3),log10(merged)),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno,merged_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 1)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 1)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))++ylab("log10(len)")
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 1)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))+ylab("log10(len)")
df <- data.frame(len=c(patient_1,patient_2,control_1,control_2,control_3,merged),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno,merged_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.9)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
patient_1<-read.table("/Users/liyuxin/projects/hopkins/data/Kpat_H3K36me3_x_LYX_13_1_2.peak_len",stringsAsFactors=F)
patient_2<-read.table("/Users/liyuxin/projects/hopkins/data/K36me3_pat_norm_x_AVD_295_1_2.peak_len",stringsAsFactors=F)
control_1<-read.table("/Users/liyuxin/projects/hopkins/data/C66_H3K36me3_x_LYX_7_1_2.peak_len",stringsAsFactors=F)
control_2<-read.table("/Users/liyuxin/projects/hopkins/data/C70_H3K36me3_x_LYX_1_1_2.peak_len",stringsAsFactors=F)
control_3<-read.table("/Users/liyuxin/projects/hopkins/data/C84_H3K36me3_x_LYX_14_1_2.peak_len",stringsAsFactors=F)
merged<-read.table("/Users/liyuxin/projects/hopkins/data/merged_normoxia.peak_len",stringsAsFactors=F)
patient_1<-data.matrix(patient_1)
patient_2<-data.matrix(patient_2)
control_1<-data.matrix(control_1)
control_2<-data.matrix(control_2)
control_3<-data.matrix(control_3)
merged<-data.matrix(merged)
patient_1_anno<-rep('patient_1',length(patient_1))
patient_2_anno<-rep('patient_2',length(patient_2))
control_1_anno<-rep('control_1',length(control_1))
control_2_anno<-rep('control_2',length(control_2))
control_3_anno<-rep('control_3',length(control_3))
merged_anno<-rep('merged',length(merged))
df <- data.frame(len=c(patient_1,patient_2,control_1,control_2,control_3,merged),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno,merged_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.9)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))
df <- data.frame(len=c(log10(patient_1),log10(patient_2),log10(control_1),log10(control_2),log10(control_3),log10(merged)),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno,merged_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3","merged"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 1)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue","springgreen4"))+ylab("log10(len)")
patient_1<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_Kpat_H3K36me3_x_LYX_13_1_2_complement.peak_len",stringsAsFactors=F)
patient_2<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_K36me3_pat_norm_x_AVD_295_1_2_complement.peak_len",stringsAsFactors=F)
control_1<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_C66_H3K36me3_x_LYX_7_1_2_complement.peak_len",stringsAsFactors=F)
control_2<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_C70_H3K36me3_x_LYX_1_1_2_complement.peak_len",stringsAsFactors=F)
control_3<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_C84_H3K36me3_x_LYX_14_1_2_complement.peak_len",stringsAsFactors=F)
patient_1<-data.matrix(patient_1)
patient_2<-data.matrix(patient_2)
control_1<-data.matrix(control_1)
control_2<-data.matrix(control_2)
control_3<-data.matrix(control_3)
patient_1_anno<-rep('patient_1',length(patient_1))
patient_2_anno<-rep('patient_2',length(patient_2))
control_1_anno<-rep('control_1',length(control_1))
control_2_anno<-rep('control_2',length(control_2))
control_3_anno<-rep('control_3',length(control_3))
df <- data.frame(len=c(log10(patient_1),log10(patient_2),log10(control_1),log10(control_2),log10(control_3)),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin(width=0.5)
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.99)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue"))+ylab("log10(len)")
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.995)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue"))+ylab("log10(len)")
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 1)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue"))+ylab("log10(len)")
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.995)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue"))+ylab("log10(len)")
patient_1<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_Kpat_Hypoxia_H3K36me3_r1_x_LYX_11_1_2_complement.peak_len",stringsAsFactors=F)
patient_2<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_K36me3_pat_hyp_x_AVD_297_1_2_complement.peak_len",stringsAsFactors=F)
control_1<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_C66_Hypoxia_H3K36me3_r1_x_LYX_4_1_2_complement.peak_len",stringsAsFactors=F)
control_2<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_C70_Hypoxia_H3K36me3_r1_x_LYX_8_1_2_complement.peak_len",stringsAsFactors=F)
control_3<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/peak_C84_Hypoxia_H3K36me3_r1_x_LYX_16_1_2_complement.peak_len",stringsAsFactors=F)
patient_1<-data.matrix(patient_1)
patient_2<-data.matrix(patient_2)
control_1<-data.matrix(control_1)
control_2<-data.matrix(control_2)
control_3<-data.matrix(control_3)
patient_1_anno<-rep('patient_1',length(patient_1))
patient_2_anno<-rep('patient_2',length(patient_2))
control_1_anno<-rep('control_1',length(control_1))
control_2_anno<-rep('control_2',length(control_2))
control_3_anno<-rep('control_3',length(control_3))
df <- data.frame(len=c(log10(patient_1),log10(patient_2),log10(control_1),log10(control_2),log10(control_3)),anno=c(patient_1_anno,patient_2_anno,control_1_anno,control_2_anno,control_3_anno))
df$anno <- factor(df$anno, levels = c("patient_1", "patient_2", "control_1","control_2","control_3"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin(width=0.5)
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.995)))+scale_fill_manual(values = c("lightpink","indianred1","lightblue","deepskyblue","royalblue"))+ylab("log10(len)")
log10(800)
log10(500)
log10(400)
narrow<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/macs2/Kpat_H3K36me3_x_LYX_13_1_2.peak_len",stringsAsFactors=F)
broad<-read.table("/Users/liyuxin/projects/hopkins/data_2019_11/macs2/Kpat_H3K36me3_x_LYX_13_1_2_peaks.broadPeak.peak_len",stringsAsFactors=F)
narrow<-data.matrix(narrow)
broad<-data.matrix(broad)
narrow_anno<-rep('narrow',length(narrow))
broad_anno<-rep('broad',length(broad))
df <- data.frame(len=c(narrow,broad),anno=c(narrow_anno,broad_anno))
df$anno <- factor(df$anno, levels = c("narrow", "broad"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin(width=0.5)
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.995)))+scale_fill_manual(values = c("lightpink","indianred1"))+ylab("log10(len)")
df <- data.frame(len=c(log10(narrow),log10(broad)),anno=c(narrow_anno,broad_anno))
df$anno <- factor(df$anno, levels = c("narrow", "broad"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin(width=0.5)
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.995)))+scale_fill_manual(values = c("lightpink","indianred1"))+ylab("log10(len)")
df <- data.frame(len=c(narrow,broad),anno=c(narrow_anno,broad_anno))
df$anno <- factor(df$anno, levels = c("narrow", "broad"))
p <- ggplot(df, aes(x=anno, y=len, fill=anno)) + geom_violin(width=0.5)
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_y_continuous(limits = quantile(df$len, c(0, 0.8)))+scale_fill_manual(values = c("lightpink","indianred1"))+ylab("log10(len)")
log10(400)
log10(300)
21082168/4
rm(lit=ls())
rm(list=ls())
ctsorigin<-read.table("/Users/liyuxin/projects/cutrun/DEseq/peak_final_merged_chip1_cutrun12_counts_matrix.tsv",sep='\t',stringsAsFactors=F,header=T,check.names=F)
total<-c(81390586,46624238,63414630,105784974)
cts_fpkm<-data.frame(chrom=ctsorigin$chrom,start=ctsorigin$start,end=ctsorigin$end,ChIP_rep1=ctsorigin$ChIP_rep1/((total[1]/1000000)*(ctsorigin$end-ctsorigin$start)),ChIP_rep2=ctsorigin$ChIP_rep2/((total[2]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep1=ctsorigin$CUT.RUN_rep1/((total[3]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep2=ctsorigin$CUT.RUN_rep2/((total[4]/1000000)*(ctsorigin$end-ctsorigin$start)))
View(cts_fpkm)
cts_fpkm2<-data.frame(chrom=ctsorigin$chrom,start=ctsorigin$start,end=ctsorigin$end,ChIP_rep1=1000*ctsorigin$ChIP_rep1/((total[1]/1000000)*(ctsorigin$end-ctsorigin$start)),ChIP_rep2=1000*ctsorigin$ChIP_rep2/((total[2]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep1=1000*ctsorigin$CUT.RUN_rep1/((total[3]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep2=1000*ctsorigin$CUT.RUN_rep2/((total[4]/1000000)*(ctsorigin$end-ctsorigin$start)))
View(cts_fpkm2)
rm(list=ls())
ctsorigin<-read.table("/Users/liyuxin/projects/cutrun/DEseq/peak_final_merged_chip1_cutrun12_counts_matrix.tsv",sep='\t',stringsAsFactors=F,header=T,check.names=F)
total<-c(81390586,46624238,63414630,105784974)
cts_fpkm<-data.frame(chrom=ctsorigin$chrom,start=ctsorigin$start,end=ctsorigin$end,ChIP_rep1=1000*ctsorigin$ChIP_rep1/((total[1]/1000000)*(ctsorigin$end-ctsorigin$start)),ChIP_rep2=1000*ctsorigin$ChIP_rep2/((total[2]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep1=1000*ctsorigin$CUT.RUN_rep1/((total[3]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep2=1000*ctsorigin$CUT.RUN_rep2/((total[4]/1000000)*(ctsorigin$end-ctsorigin$start)))
cts<-cts_fpkm[c(4:7)]
ChIP_rep1<-data.matrix(cts$ChIP_rep1)
ChIP_rep2<-data.matrix(cts$ChIP_rep2)
CUTRUN_rep1<-data.matrix(cts$CUT.RUN_rep1)
CUTRUN_rep2<-data.matrix(cts$CUT.RUN_rep2)
ChIP_rep1_anno<-rep('ChIP_rep1',length(ChIP_rep1))
ChIP_rep2_anno<-rep('ChIP_rep2',length(ChIP_rep2))
CUTRUN_rep1_anno<-rep('CUTRUN_rep1',length(CUTRUN_rep1))
CUTRUN_rep2_anno<-rep('CUTRUN_rep2',length(CUTRUN_rep2))
summary(ChIP_rep1)
pseu=0.01
df <- data.frame(rpkm=c(log2(ChIP_rep1+pseu),log2(ChIP_rep2+pseu),log2(CUTRUN_rep1+pseu),log2(CUTRUN_rep2+pseu)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
df$anno <- factor(df$anno, levels = c("ChIP_rep1", "ChIP_rep2", "CUTRUN_rep1", "CUTRUN_rep2"))
p <- ggplot(df, aes(x=anno, y=rpkm, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.03,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("rpkm")+scale_y_continuous(limits = quantile(df$rpkm, c(0.05, 0.75)))
p + geom_boxplot(width=0.03,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(rpkm+pseu)")
pseu=0.001df <- data.frame(rpkm=c(log2(ChIP_rep1+pseu),log2(ChIP_rep2+pseu),log2(CUTRUN_rep1+pseu),log2(CUTRUN_rep2+pseu)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
pseu=0.001
df <- data.frame(rpkm=c(log2(ChIP_rep1+pseu),log2(ChIP_rep2+pseu),log2(CUTRUN_rep1+pseu),log2(CUTRUN_rep2+pseu)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
p <- ggplot(df, aes(x=anno, y=rpkm, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.03,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(rpkm+pseu)")
pseu=0.025
df <- data.frame(rpkm=c(log2(ChIP_rep1+pseu),log2(ChIP_rep2+pseu),log2(CUTRUN_rep1+pseu),log2(CUTRUN_rep2+pseu)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
p <- ggplot(df, aes(x=anno, y=rpkm, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.03,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(rpkm+pseu)")
cts_norm<-normalize.quantiles(as.matrix(cts_high),copy=TRUE)
ChIP_rep1_norm<-data.matrix(cts_norm[,1])
ChIP_rep2_norm<-data.matrix(cts_norm[,2])
CUTRUN_rep1_norm<-data.matrix(cts_norm[,3])
CUTRUN_rep2_norm<-data.matrix(cts_norm[,4])
library( preprocessCore)
cts_norm<-normalize.quantiles(as.matrix(cts_high),copy=TRUE)
ChIP_rep1_norm<-data.matrix(cts_norm[,1])
ChIP_rep2_norm<-data.matrix(cts_norm[,2])
CUTRUN_rep1_norm<-data.matrix(cts_norm[,3])
CUTRUN_rep2_norm<-data.matrix(cts_norm[,4])
View(cts_fpkm)
summary(CUTRUN_rep1)
pseu
pseu=0.01
df <- data.frame(rpkm=c(log2(ChIP_rep1+pseu),log2(ChIP_rep2+pseu),log2(CUTRUN_rep1+pseu),log2(CUTRUN_rep2+pseu)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
p <- ggplot(df, aes(x=anno, y=rpkm, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.03,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(rpkm+pseu)")
high<-apply(log2(cts+pseu), 1, function(x){any(x>log2(1.5+pseu))})
dim(cts[high,])
cts_high<-cts[high,]
dim(cts_high)
View(cts_high)
View(cts_fpkm)
cts_high_full<-cts_fpkm[high,]
View(cts_high_full)
write.table(as.data.frame(cts_high_full), file="/Users/liyuxin/projects/cutrun/DEseq/peak_final_merged_chip1_cutrun12_filtered.tsv")
write.csv(as.data.frame(cts_high_full), file="/Users/liyuxin/projects/cutrun/DEseq/peak_final_merged_chip1_cutrun12_filtered.csv")
high<-apply(log2(cts+pseu), 1, function(x){any(x>log2(2+pseu))})
dim(cts[high,])
cts_high<-cts[high,]
cts_high_full<-cts_fpkm[high,]
write.table(as.data.frame(cts_high_full), file="/Users/liyuxin/projects/cutrun/DEseq/peak_final_merged_chip1_cutrun12_filtered_28384.tsv")
rm(list=ls())
ctsorigin<-read.table("/Users/liyuxin/projects/cutrun/DEseq/peak_final_merged_chip1_cutrun12_counts_matrix.tsv",sep='\t',stringsAsFactors=F,header=T,check.names=F)
total<-c(81390586,46624238,63414630,105784974)
cts_fpkm<-data.frame(chrom=ctsorigin$chrom,start=ctsorigin$start,end=ctsorigin$end,ChIP_rep1=1000*ctsorigin$ChIP_rep1/((total[1]/1000000)*(ctsorigin$end-ctsorigin$start)),ChIP_rep2=1000*ctsorigin$ChIP_rep2/((total[2]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep1=1000*ctsorigin$CUT.RUN_rep1/((total[3]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep2=1000*ctsorigin$CUT.RUN_rep2/((total[4]/1000000)*(ctsorigin$end-ctsorigin$start)))
cts<-cts_fpkm[c(4:7)]
ChIP_rep1<-data.matrix(cts$ChIP_rep1)
ChIP_rep2<-data.matrix(cts$ChIP_rep2)
CUTRUN_rep1<-data.matrix(cts$CUT.RUN_rep1)
CUTRUN_rep2<-data.matrix(cts$CUT.RUN_rep2)
ChIP_rep1_anno<-rep('ChIP_rep1',length(ChIP_rep1))
ChIP_rep2_anno<-rep('ChIP_rep2',length(ChIP_rep2))
CUTRUN_rep1_anno<-rep('CUTRUN_rep1',length(CUTRUN_rep1))
CUTRUN_rep2_anno<-rep('CUTRUN_rep2',length(CUTRUN_rep2))
pseu=0.01
df <- data.frame(rpkm=c(log2(ChIP_rep1+pseu),log2(ChIP_rep2+pseu),log2(CUTRUN_rep1+pseu),log2(CUTRUN_rep2+pseu)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
p <- ggplot(df, aes(x=anno, y=rpkm, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.03,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(rpkm+pseu)")
high<-apply(log2(cts+pseu), 1, function(x){any(x>log2(2+pseu))})
dim(cts[high,])
cts_high<-cts[high,]
p1 <- ggplot(cts_fpkm, aes(log2(ChIP_rep1+pseu), log2(ChIP_rep2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(0.002+pseu)),type = "densigram")
library(ggExtra)
p1 <- ggplot(cts_fpkm, aes(log2(ChIP_rep1+pseu), log2(ChIP_rep2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(0.002+pseu)),type = "densigram")
p1 <- ggplot(cts_fpkm, aes(log2(ChIP_rep1+pseu), log2(ChIP_rep2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(2+pseu)),type = "densigram")
p <- ggplot(cts_fpkm, aes(log2(CUT.RUN_rep1+pseu), log2(CUT.RUN_rep2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(2+pseu)),type = "densigram")
View(cts_high)
p1 <- ggplot(cts_high, aes(log2(ChIP_rep1+pseu), log2(ChIP_rep2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(2+pseu)),type = "densigram")
p <- ggplot(cts_high, aes(log2(CUT.RUN_rep1+pseu), log2(CUT.RUN_rep2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(2+pseu)),type = "densigram")
ChIP_rep1<-data.matrix(cts_high$ChIP_rep1)
ChIP_rep2<-data.matrix(cts_high$ChIP_rep2)
CUTRUN_rep1<-data.matrix(cts_high$CUT.RUN_rep1)
CUTRUN_rep2<-data.matrix(cts_high$CUT.RUN_rep2)
ChIP_rep1_anno<-rep('ChIP_rep1',length(ChIP_rep1))
ChIP_rep2_anno<-rep('ChIP_rep2',length(ChIP_rep2))
CUTRUN_rep1_anno<-rep('CUTRUN_rep1',length(CUTRUN_rep1))
CUTRUN_rep2_anno<-rep('CUTRUN_rep2',length(CUTRUN_rep2))
df <- data.frame(rpkm=c(log2(ChIP_rep1+pseu),log2(ChIP_rep2+pseu),log2(CUTRUN_rep1+pseu),log2(CUTRUN_rep2+pseu)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
df$anno <- factor(df$anno, levels = c("ChIP_rep1", "ChIP_rep2", "CUTRUN_rep1", "CUTRUN_rep2"))
p <- ggplot(df, aes(x=anno, y=rpkm, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.03,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(rpkm+pseu)")
cts_norm<-normalize.quantiles(as.matrix(cts_high),copy=TRUE)
ChIP_rep1_norm<-data.matrix(cts_norm[,1])
ChIP_rep2_norm<-data.matrix(cts_norm[,2])
CUTRUN_rep1_norm<-data.matrix(cts_norm[,3])
CUTRUN_rep2_norm<-data.matrix(cts_norm[,4])
df <- data.frame(counts=c(log2(ChIP_rep1_norm+pseu),log2(ChIP_rep2_norm+pseu),log2(CUTRUN_rep1_norm+pseu),log2(CUTRUN_rep2_norm+pseu)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
df$anno <- factor(df$anno, levels = c("ChIP_rep1", "ChIP_rep2", "CUTRUN_rep1", "CUTRUN_rep2"))
p <- ggplot(df, aes(x=anno, y=counts, fill=anno)) +  geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(normalized rpkm+pseu)")
View(cts_norm)
p1 <- ggplot(cts_norm, aes(log2(cts_norm[,1]+pseu), log2(cts_norm[,2]+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(2+pseu)),type = "densigram")
head(log2(cts_norm[,1]+pseu))
p1_norm <- ggplot(cts_norm, aes(log2(cts_norm[,1]+pseu), log2(cts_norm[,2]+pseu)))+geom_point(colour = "red",size=0.1)
p1_norm <- ggplot(data.frame(cts_norm), aes(log2(V1+pseu), log2(V2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1_norm+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(2+pseu)),type = "densigram")
ff<-data.frame(cts_norm)
View(ff)
View(ff)
p1_norm <- ggplot(data.frame(cts_norm), aes(log2(X1+pseu), log2(X2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1_norm+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(2+pseu)),type = "densigram")
p1_norm <- ggplot(data.frame(cts_norm), aes(log2(X1+pseu), log2(X2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1_norm+xlab("ChIP_rep1")+ylab("ChIP_rep2"),type = "densigram")
p_norm <- ggplot(data.frame(cts_norm), aes(log2(X3+pseu), log2(X4+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1_norm+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2"),type = "densigram")
ggMarginal(p_norm+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2"),type = "densigram")
View(cts_norm)
rm(list=ls())
ctsorigin<-read.table("/Users/liyuxin/projects/cutrun/DEseq/peak_final_merged_chip1_cutrun12_counts_matrix.tsv",sep='\t',stringsAsFactors=F,header=T,check.names=F)
total<-c(81390586,46624238,63414630,105784974)
cts_fpkm<-data.frame(chrom=ctsorigin$chrom,start=ctsorigin$start,end=ctsorigin$end,ChIP_rep1=1000*(ctsorigin$ChIP_rep1+1)/((total[1]/1000000)*(ctsorigin$end-ctsorigin$start)),ChIP_rep2=1000*(ctsorigin$ChIP_rep2+1)/((total[2]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep1=1000*(ctsorigin$CUT.RUN_rep1+1)/((total[3]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep2=1000*(ctsorigin$CUT.RUN_rep2+1)/((total[4]/1000000)*(ctsorigin$end-ctsorigin$start)))
View(cts_fpkm)
p1 <- ggplot(cts_fpkm, aes(log2(ChIP_rep1), log2(ChIP_rep2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2+pseu))+geom_hline(yintercept = log2(2+pseu)),type = "densigram")
p <- ggplot(cts_fpkm, aes(log2(CUT.RUN_rep1), log2(CUT.RUN_rep2)))+geom_point(colour = "red",size=0.1)
p1 <- ggplot(cts_fpkm, aes(log2(ChIP_rep1), log2(ChIP_rep2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2))+geom_hline(yintercept = log2(2)),type = "densigram")
p <- ggplot(cts_fpkm, aes(log2(CUT.RUN_rep1), log2(CUT.RUN_rep2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2")+geom_vline(xintercept = log2(2))+geom_hline(yintercept = log2(2)),type = "densigram")
cts_high_full<-cts_fpkm[high,]
high<-apply(log2(cts), 1, function(x){any(x>log2(2))})
dim(cts[high,])
cts_high<-cts[high,]
high<-apply(log2(cts), 1, function(x){any(x>log2(2))})
dim(cts[high,])
cts_high<-cts[high,]
cts<-cts_fpkm[c(4:7)]
high<-apply(log2(cts), 1, function(x){any(x>log2(2))})
dim(cts[high,])
cts_high<-cts[high,]
p1 <- ggplot(cts_high, aes(log2(ChIP_rep1), log2(ChIP_rep2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2))+geom_hline(yintercept = log2(2)),type = "densigram")
p <- ggplot(cts_high, aes(log2(CUT.RUN_rep1), log2(CUT.RUN_rep2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2")+geom_vline(xintercept = log2(2))+geom_hline(yintercept = log2(2)),type = "densigram")
View(cts_high)
View(cts_fpkm)
View(cts_fpkm)
View(ctsorigin)
View(cts_fpkm)
View(cts_high)
View(ctsorigin)
rm(list=ls())
ctsorigin<-read.table("/Users/liyuxin/projects/cutrun/DEseq/peak_final_merged_chip1_cutrun12_counts_matrix.tsv",sep='\t',stringsAsFactors=F,header=T,check.names=F)
total<-c(81390586,46624238,63414630,105784974)
cts_fpkm<-data.frame(chrom=ctsorigin$chrom,start=ctsorigin$start,end=ctsorigin$end,ChIP_rep1=1000*ctsorigin$ChIP_rep1/((total[1]/1000000)*(ctsorigin$end-ctsorigin$start)),ChIP_rep2=1000*ctsorigin$ChIP_rep2/((total[2]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep1=1000*ctsorigin$CUT.RUN_rep1/((total[3]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep2=1000*ctsorigin$CUT.RUN_rep2/((total[4]/1000000)*(ctsorigin$end-ctsorigin$start)))
cts_fpkm<-data.frame(chrom=ctsorigin$chrom,start=ctsorigin$start,end=ctsorigin$end,ChIP_rep1=1000*(ctsorigin$ChIP_rep1+1)/((total[1]/1000000)*(ctsorigin$end-ctsorigin$start)),ChIP_rep2=1000*(ctsorigin$ChIP_rep2+1)/((total[2]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep1=1000*(ctsorigin$CUT.RUN_rep1+1)/((total[3]/1000000)*(ctsorigin$end-ctsorigin$start)),CUT.RUN_rep2=1000*(ctsorigin$CUT.RUN_rep2+1)/((total[4]/1000000)*(ctsorigin$end-ctsorigin$start)))
cts_cpm<-data.frame(chrom=ctsorigin$chrom,start=ctsorigin$start,end=ctsorigin$end,ChIP_rep1=(ctsorigin$ChIP_rep1+1)/(total[1]/1000000),ChIP_rep2=(ctsorigin$ChIP_rep2+1)/(total[2]/1000000),CUT.RUN_rep1=(ctsorigin$CUT.RUN_rep1+1)/(total[3]/1000000),CUT.RUN_rep2=(ctsorigin$CUT.RUN_rep2+1)/(total[4]/1000000))
cts_counts<-ctsorigin
View(cts_cpm)
View(cts_fpkm)
View(cts_cpm)
View(cts_fpkm)
780018-777621
cts<-cts_fpkm[c(4:7)]
high<-apply(log2(cts), 1, function(x){any(x>log2(2))})
dim(cts[high,])
cts_high<-cts[high,]
cts_high_full<-cts_fpkm[high,]
write.table(as.data.frame(cts_high_full), file="/Users/liyuxin/projects/cutrun/DEseq/peak_final_merged_chip1_cutrun12_filtered_28652.tsv")
p1 <- ggplot(cts_fpkm, aes(log2(ChIP_rep1), log2(ChIP_rep2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2))+geom_hline(yintercept = log2(2)),type = "densigram")
p <- ggplot(cts_fpkm, aes(log2(CUT.RUN_rep1), log2(CUT.RUN_rep2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2")+geom_vline(xintercept = log2(2))+geom_hline(yintercept = log2(2)),type = "densigram")
p1 <- ggplot(cts_high, aes(log2(ChIP_rep1), log2(ChIP_rep2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1+xlab("ChIP_rep1")+ylab("ChIP_rep2")+geom_vline(xintercept = log2(2))+geom_hline(yintercept = log2(2)),type = "densigram")
ggMarginal(p+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2")+geom_vline(xintercept = log2(2))+geom_hline(yintercept = log2(2)),type = "densigram")
p <- ggplot(cts_high, aes(log2(CUT.RUN_rep1), log2(CUT.RUN_rep2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2")+geom_vline(xintercept = log2(2))+geom_hline(yintercept = log2(2)),type = "densigram")
cts<-cts_cpm[c(4:7)]
ChIP_rep1<-data.matrix(cts$ChIP_rep1)
ChIP_rep2<-data.matrix(cts$ChIP_rep2)
CUTRUN_rep1<-data.matrix(cts$CUT.RUN_rep1)
CUTRUN_rep2<-data.matrix(cts$CUT.RUN_rep2)
ChIP_rep1_anno<-rep('ChIP_rep1',length(ChIP_rep1))
ChIP_rep2_anno<-rep('ChIP_rep2',length(ChIP_rep2))
CUTRUN_rep1_anno<-rep('CUTRUN_rep1',length(CUTRUN_rep1))
CUTRUN_rep2_anno<-rep('CUTRUN_rep2',length(CUTRUN_rep2))
ChIP_rep1<-data.matrix(cts$ChIP_rep1)
ChIP_rep2<-data.matrix(cts$ChIP_rep2)
CUTRUN_rep1<-data.matrix(cts$CUT.RUN_rep1)
CUTRUN_rep2<-data.matrix(cts$CUT.RUN_rep2)
ChIP_rep1_anno<-rep('ChIP_rep1',length(ChIP_rep1))
ChIP_rep2_anno<-rep('ChIP_rep2',length(ChIP_rep2))
CUTRUN_rep1_anno<-rep('CUTRUN_rep1',length(CUTRUN_rep1))
CUTRUN_rep2_anno<-rep('CUTRUN_rep2',length(CUTRUN_rep2))
df <- data.frame(rpkm=c(log2(ChIP_rep1),log2(ChIP_rep2),log2(CUTRUN_rep1),log2(CUTRUN_rep2)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
p <- ggplot(df, aes(x=anno, y=rpkm, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.03,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(cpm)")
cts_high<-cts_cpm[high,]
ChIP_rep1<-data.matrix(cts_high$ChIP_rep1)
ChIP_rep2<-data.matrix(cts_high$ChIP_rep2)
CUTRUN_rep1<-data.matrix(cts_high$CUT.RUN_rep1)
CUTRUN_rep2<-data.matrix(cts_high$CUT.RUN_rep2)
ChIP_rep1_anno<-rep('ChIP_rep1',length(ChIP_rep1))
ChIP_rep2_anno<-rep('ChIP_rep2',length(ChIP_rep2))
CUTRUN_rep1_anno<-rep('CUTRUN_rep1',length(CUTRUN_rep1))
CUTRUN_rep2_anno<-rep('CUTRUN_rep2',length(CUTRUN_rep2))
df <- data.frame(rpkm=c(log2(ChIP_rep1),log2(ChIP_rep2),log2(CUTRUN_rep1),log2(CUTRUN_rep2)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
df$anno <- factor(df$anno, levels = c("ChIP_rep1", "ChIP_rep2", "CUTRUN_rep1", "CUTRUN_rep2"))
p <- ggplot(df, aes(x=anno, y=rpkm, fill=anno)) + geom_violin()
p + geom_boxplot(width=0.03,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(cpm)")
cts_norm<-normalize.quantiles(as.matrix(cts_high),copy=TRUE)
ChIP_rep1_norm<-data.matrix(cts_norm[,1])
ChIP_rep2_norm<-data.matrix(cts_norm[,2])
CUTRUN_rep1_norm<-data.matrix(cts_norm[,3])
CUTRUN_rep2_norm<-data.matrix(cts_norm[,4])
df <- data.frame(counts=c(log2(ChIP_rep1_norm),log2(ChIP_rep2_norm),log2(CUTRUN_rep1_norm),log2(CUTRUN_rep2_norm)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
df$anno <- factor(df$anno, levels = c("ChIP_rep1", "ChIP_rep2", "CUTRUN_rep1", "CUTRUN_rep2"))
p <- ggplot(df, aes(x=anno, y=counts, fill=anno)) +  geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(normalized cpm)")
dim()
View(cts_high)
head(cts_high[c(4:7)])
ChIP_rep1_norm<-data.matrix(cts_norm[,1])
ChIP_rep2_norm<-data.matrix(cts_norm[,2])
CUTRUN_rep1_norm<-data.matrix(cts_norm[,3])
CUTRUN_rep2_norm<-data.matrix(cts_norm[,4])
df <- data.frame(counts=c(log2(ChIP_rep1_norm),log2(ChIP_rep2_norm),log2(CUTRUN_rep1_norm),log2(CUTRUN_rep2_norm)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
df$anno <- factor(df$anno, levels = c("ChIP_rep1", "ChIP_rep2", "CUTRUN_rep1", "CUTRUN_rep2"))
p <- ggplot(df, aes(x=anno, y=counts, fill=anno)) +  geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(normalized cpm)")
cts_norm<-normalize.quantiles(as.matrix(cts_high[c(4:7)]),copy=TRUE)
ChIP_rep1_norm<-data.matrix(cts_norm[,1])
ChIP_rep2_norm<-data.matrix(cts_norm[,2])
CUTRUN_rep1_norm<-data.matrix(cts_norm[,3])
CUTRUN_rep2_norm<-data.matrix(cts_norm[,4])
df <- data.frame(counts=c(log2(ChIP_rep1_norm),log2(ChIP_rep2_norm),log2(CUTRUN_rep1_norm),log2(CUTRUN_rep2_norm)),anno=c(ChIP_rep1_anno,ChIP_rep2_anno,CUTRUN_rep1_anno,CUTRUN_rep2_anno))
df$anno <- factor(df$anno, levels = c("ChIP_rep1", "ChIP_rep2", "CUTRUN_rep1", "CUTRUN_rep2"))
p <- ggplot(df, aes(x=anno, y=counts, fill=anno)) +  geom_violin()
p + geom_boxplot(width=0.07,outlier.size = 0,fill="white")+scale_fill_manual(values = c("#E0FFFF","#AFEEEE","#D8BFD8","#DDA0DD"))+ylab("log2(normalized cpm)")
summary(ChIP_rep1_norm)
summary(CUTRUN_rep1_norm)
View(cts_norm)
p1_norm <- ggplot(data.frame(cts_norm), aes(log2(X1+pseu), log2(X2+pseu)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1_norm+xlab("ChIP_rep1")+ylab("ChIP_rep2"),type = "densigram")
p1_norm <- ggplot(data.frame(cts_norm), aes(log2(X1), log2(X2)))+geom_point(colour = "red",size=0.1)
ggMarginal(p1_norm+xlab("ChIP_rep1")+ylab("ChIP_rep2"),type = "densigram")
dim(data.frame(cts_norm))
p_norm <- ggplot(data.frame(cts_norm), aes(log2(X3), log2(X4)))+geom_point(colour = "red",size=0.1)
ggMarginal(p_norm+xlab("CUTRUN_rep1")+ylab("CUTRUN_rep2"),type = "densigram")
View(cts_cpm)
View(cts_high_full)
View(cts_high)
View(cts_norm)
BiocManager::install("limma")
View(cts_norm)
coldata<-read.table("/Users/liyuxin/projects/cutrun/DEseq/anno.txt",header=T,row.names=1)
all(rownames(coldata)==colnames(cts_norm))
rownames(coldata)
colnames(cts_norm)
lmfit<-lmFit(cts_norm,coldata)
library(limma)
lmfit<-lmFit(cts_norm,coldata)
tech<-factor(c(rep('chip',24),rep('cutrun',2)))
tech
tech<-factor(c(rep('chip',2),rep('cutrun',2)))
tech
design<-model.matrix(~tech)
design
lmfit<-lmFit(cts_norm,design)
View(lmfit)
lmfit<-eBayes(lmfit,trend=TRUE)
View(lmfit)
topTable(lmfit)
topTable(lmfit,coef=2)
?topTable
topTable(lmfit,coef=2,sort.by="None")
topTable(lmfit,coef=2,sort.by="none")
tech<-factor(c(rep('chip',2),rep('cutrun',2)))
design<-model.matrix(~tech)
lmfit<-lmFit(cts_norm,design)
lmfit<-eBayes(lmfit,trend=FALSE)
topTable(lmfit,coef=2,sort.by="none")
?eBayes
?lmFit
dim(topTable(lmfit,coef=2,sort.by="none"))
head(lmfit)
dim(topTable(lmfit,coef=2,sort.by="none",number=20))
dim(topTable(lmfit,coef=2,sort.by="none",number=28652))
head(topTable(lmfit,coef=2,sort.by="none",number=28652))
dim(cts_norm)
dim(cts_norm)[0]
dim(cts_norm)[1]
dim(topTable(lmfit,coef=2,sort.by="none",number=dim(cts_norm)[1]))
head(cbind(cts_cpm,ctd_norm))
head(cbind(cts_cpm,cts_norm))
View(cts_high)
head(cbind(cts_high,cts_norm))
res<-head(cbind(cts_high,cts_norm,topTable(lmfit,coef=2,sort.by="none",number=dim(cts_norm)[1])))
write.table(as.data.frame(res), file="/Users/liyuxin/projects/cutrun/DEseq/1125_limma_on_cpm_28652.tsv")
View(res)
View(res)
dim(cts_norm)[1]
res<-cbind(cts_high,cts_norm,topTable(lmfit,coef=2,sort.by="none",number=dim(cts_norm)[1]))
write.csv(as.data.frame(res), file="/Users/liyuxin/projects/cutrun/DEseq/1125_limma_on_cpm_28652.csv")
View(cts_counts)
cts_counts_high<-cts_counts[high,]
View(cts_counts_high)
cts_counts_high<-cts_counts[high,]
v<-voom(cts_counts[c(4:7)],design,plot=TRUE,normalize="quantile")
lmfit<-lmFit(v,design)
lmfit<-eBayes(lmfit,trend=TRUE)
View(v)
head(cts_counts[c(4:7)])
lmfit<-eBayes(lmfit)
lmfit<-lmFit(v,design)
lmfit<-eBayes(lmfit)
topTable(lmfit,coef=2,sort.by="none")
getwd()
setwd('/Users/liyuxin/djangoprojects/epigen_ucsd_django/utility')
getwd()
source(encode_step1_grab_metadata_from_link.R,print.eval=TRUE)
source('encode_step1_grab_metadata_from_link.R,print.eval=TRUE)
source('encode_step1_grab_metadata_from_link.R',print.eval=TRUE)
source('encode_step1_grab_metadata_from_link.R',print.eval=TRUE)
