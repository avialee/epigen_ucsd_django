{% extends 'nextseq_app/base.html' %}

{% block content %}
{% load nextseq_app_tags %}
{% load humanize %}

<div id="content" class="col-sm-10 col-md-10 col-lg-10">
  <div class="card">
    <div class="card-header fortable">
      All Runs
    </div><!-- /.card-header -->
    <div class="card-body">
      {% if request.user|has_group:"bioinformatics" %}
      <table class="table table-striped table-sm datatablesort2 text-center table-responsive-xl">
      {% else %}
      <table class="table table-sm table-striped table-bordered datatablesort2 text-center table-responsive-xl">
      {% endif %}
        <thead>
          <tr>
            <th scope="col">Flowcell</th>
            <th scope="col">Operator</th>
            <th scope="col">Date</th>
            <th scope="col">Read Type</th>
            <th scope="col">Read Length</th>
            <th scope="col">Total libraries</th>
            <th scope="col">Total reads</th>
            <th scope="col">%demultiplexed</th>	    	    
            {% if request.user|has_group:"bioinformatics" %}
            <th scope="col">Last Modified</th>
            {% endif %}
            <th scope="col">Demultiplexing</th>
            {% if request.user|has_group:"bioinformatics" %}
            <th scope="col"></th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for Run in RunInfo_list %}
          <tr>        
                <td><a href="{% url 'nextseq_app:rundetail' Run.pk %}"> {{ Run.Flowcell_ID }} </a></td>
            <td>{{ Run.operator }}</td>
            <td id="date-{{Run.Flowcell_ID}}">{{ Run.date|date:"m/d/Y" }}</td>
            <td>{{ Run.read_type }}</td>
            <td>{{ Run.read_length }}</td>
            <td>{{ Run.total_libraries }}</td>
       	<td>{{ Run.total_reads|intcomma }}</td>
		<td>  <div class="progress">
		    <div class="progress-bar" role="progressbar" aria-valuenow={{Run.percent_of_reads_demultiplexed}} aria-valuemin="0" aria-valuemax="100" style="width:{{ Run.percent_of_reads_demultiplexed|percentage}}">
            {{ Run.percent_of_reads_demultiplexed|percentage }}
	  </div></td>
            {% if request.user|has_group:"bioinformatics" %}
            <td>{{ Run.updated_at|date:"m/d/Y H:i" }}</td>
            {% endif %}
            {% if Run.jobstatus == 'Done'%}
            <td><span class="badge badge-success badge-status-green">Done</span></td>
            {% elif Run.jobstatus == 'ClickToSubmit' %}
              {% if request.user|has_group:"bioinformatics" %}
              <td><a class="btn btn-danger btn-sm btn-status-orange dmpajax" href="" data-href="{% url 'nextseq_app:demultiplexing' Run.id %}" id={{Run.Flowcell_ID}}>ClickToSubmit</a></td>
              {% else %}
              <td><span class="badge badge-success badge-status-orange">ToSubmit</span></td>
              {% endif %}
            {% elif Run.jobstatus == 'JobSubmitted'%}
            <td><span class="badge badge-success badge-status-blue">JobSubmitted</span></td>
            {% elif Run.jobstatus == 'JobStarted'%}
            <td><span class="badge badge-success badge-status-lightblue">JobStarted</span></td>
            {% elif Run.jobstatus == 'Error'%}
            <td><span class="badge badge-success badge-status-yellow">Error</span></td>
            {% elif Run.jobstatus == 'Warning'%}
            <td><span class="badge badge-success badge-status-yellow" data-toggle="tooltip" data-placement="right" title="contain libraries with reads number less than 1000">Warning</span></td>
            {% endif %}
            {% if request.user|has_group:"bioinformatics" %}
            <td>
              <a class="spacing" href="{% url 'nextseq_app:run_update' username=user.username run_pk=Run.id %}"><i class="fas fa-edit"></i></a>
              <a onclick="return confirm('Are you sure you want to delete {{ Run.Flowcell_ID }} ?');" href="{% url 'nextseq_app:run_delete2' Run.id %}"><i class="fas fa-trash-alt"></i></a>                
            </td>
            {% endif %}
          </tr>
          {% empty %}
          <li>No Runs yet.</li>
          {% endfor %}
        </tbody>
      </table>
    </div><!-- /.card-body -->              
  </div><!-- /.card -->      
</div><!-- /#content --> 



{% endblock %}
