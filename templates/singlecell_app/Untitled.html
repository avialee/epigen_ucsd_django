{% extends 'singlecell_app/base.html' %}
{% block content %}
{% load nextseq_app_tags %}
{% load singlecell_extras %}

<div id="content" class="col-sm-10 col-md-10 col-lg-10">
    <div class="card">
        <div class="card-header fortable">
            {{ type }}
        </div><!-- /.card-header -->
        <div class="card-body">
            <table id="datatable-sc" class="table table-striped table-sm text-center table-responsive-xl">
                <thead>
                    <tr>
                        {% for head in header %}
                        <th> {{ head }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                {% if seqs_info %}
                {% for seq in seqs_info %}
                <tr>
                    <td>
                        {{ seq.0 }}
                    </td>
                    <td>
                        <a href="{% url 'masterseq_app:lib_detail' seq.2 %}">{{ seq.1 }}</a>
                    </td>
                    <td>
                        {{ seq.3 }}
                    </td>
                    <td>
                        {{seq.4}}
                    </td>
                    <td>
                        {{seq.5}}
                    </td>


                    {# comment seq.6: 10xProcessed#}

                    {% if seq.3 == '10xATAC' and seq.8 == 'Owner' or seq.3 == 'scATAC-seq' and seq.8 == 'Owner' %}
                    {% if seq.6 == 'No' and seq.5 == 'Yes' and seq.3 == '10xATAC' %}{# 10xatac experiment, 10xNot ran FASTQ files present, user can submit  #}
                    <td>
                        <form method="post">{%csrf_token%}
                            <button type="submit" class="btn btn-sm btn-status-orange runsinglecell"
                                singlecell-submission-url="{% url 'singlecell_app:submitsinglecell'%}" email={{email}}
                                name="buttonTenX" value="{{seq.0}}">
                                ClickToSubmit
                            </button>
                        </form>
                    </td>
                    {% elif seq.6 == 'No' and seq.5 == 'Yes' and seq.3 == 'scATAC-seq' %}{# not10xATAC experiment, 10x has not ran, FASTQ files present, user owns seq #}
                    <td>
                        <form method="post">{%csrf_token%}
                            <button type="submit" class="btn btn-danger btn-sm btn-status-orange runsinglecell"
                                singlecell-submission-url="{% url 'singlecell_app:submitsinglecell'%}" email={{email}}
                                name="buttonTenX" value="{{seq.0}}">
                                ClickToSubmit
                            </button>
                        </form>
                    </td>
                    {% elif seq.6 == 'No' and seq.5 == 'No' %}{# no fastq files present and no 10x ran #}
                    <td>
                        <button type="button" class="badge badge-success badge-status-blue" data-toggle="tooltip"
                            data-placement="top" title="No FASTQ files available" name="buttonTenX">
                            ClickToSubmit
                        </button>
                    </td>
                    {%elif seq.6 == 'Yes' %}{#10x has completed running#}
                    <td>
                        {% url 'setqc_app:10xATACoutput2' seq.0 as the_url %}
                        <a href="{{the_url}}" class="btn btn-primary btn-sm btn-status-white" role="button">
                            Results
                        </a>
                    </td>
                    {%elif seq.6 == 'In Queue' or seq.6 == 'In Process' %} {#present 10x stage#}
                    <td>
                        <button type="button" class="badge badge-success badge-status-lightblue" disabled>
                            {{ seq.6 }}
                        </button>
                    </td>
                    {%else%}
                    <td>
                        <button type="button" class="badge badge-success badge-status-red" data-toggle="tooltip"
                            data-placement="top" title="Contact bioinformatics group!">
                            {{ seq.6 }}
                        </button>
                    </td>
                    {%endif%}
                    {%else%}
                    <td>
                        <button class="btn btn-secondary btn-sm" type="button" disabled name="buttonTenX">
                            {{ seq.6 }}
                        </button>
                    </td>
                    {% endif %}

                    {# comment seq.7: snapatac/cooladmin#}
                    {% if seq.5 == 'Yes' and seq.8 == 'Owner' and seq.7 == 'ClickToSubmit' %}
                    {% if seq.3 == '10xATAC' and seq.6 == 'Yes' %}{# only launch 10xATAC sequences in cooladmin when 10x had been processed already #}
                    <td>
                        <button type="button" class="btn btn-danger btn-sm btn-status-orange  cooladmin-submit"
                            cooladmin-submission-url="{% url 'singlecell_app:submitcooladmin' %}" value="{{seq.0}}"
                            email="{{email}}">
                            ClickToSubmit
                        </button>
                    </td>
                    {% elif seq.3 == '10xATAC' and seq.6 != 'Yes' %}
                    <td>
                        <button type="button" data-toggle="tooltip" data-placement="top" title="Run10xPipeline First"
                            class="badge-success badge-status-blue cooladmin-submit"
                            cooladmin-submission-url="{% url 'singlecell_app:submitcooladmin' %}" disabled
                            value="{{seq.0}}" email="{{email}}">
                            Run10xPipeline
                        </button>
                    </td>
                    {% else %}
                    <td>
                        <button type="button" class="btn btn-danger btn-sm btn-status-orange cooladmin-submit"
                            cooladmin-submission-url="{% url 'singlecell_app:submitcooladmin' %}" value="{{seq.0}}"
                            email="{{email}}">
                            ClickToSubmit
                        </button>
                    </td>
                    {% endif %}

                    {%elif seq.5 == 'Yes' and seq.7 == '.status.fail' %}
                    <td>
                        <button type="button" class="badge badge-success badge-status-yellow cooladmin-status"
                            value="{{seq.0}}">
                            {{seq.7}}
                        </button>
                    </td>
                    {%elif seq.7 == '.status.processing' or seq.7 == 'Submitted'%}
                    <td>
                        <button type="button" class="badge badge-success badge-status-lightblue cooladmin-status"
                            value="{{seq.0}}">
                            {{seq.7}}
                        </button>
                    </td>
                    {%elif seq.5 == 'Yes' and seq.7 == '.status.success'%}
                    <td>
                        <a href="{{seq.9}}" target="_blank">CoolAdmin Link</badge>
                        </a>
                    </td>
                    {% else %}
                    <td>
                        <button type="button" disabled class="badge badge-success badge-status-blue">
                            {{seq.7}}
                        </button>
                    </td>
                    {% endif %}
                    <td>{%if seq.3 != '10xATAC' or seq.6 == 'Yes' %}
                        <a href="{% url 'singlecell_app:editcooladmin' seq.0 %}"><i class="fas fa-edit"></i></a>
                        {%else%}
                        <a href="#"><i class="fas fa-edit"></i></a>
                        {%endif%}
                    </td>
                </tr>
                {% endfor %}
                {%else%}
                No seqs
                {% endif %}
            </table>
        </div>
    </div>
</div>


{% endblock content %}